
<!-- The overlay -->
<div id="myNav" class="overlay">
    <div class="overlay-content">
        <img src="/assets/img/spinner.svg" alt="">
        <br>
        <h1 class="">Cargando</h1>
    </div>
</div>
<section class="container-fluid" style="min-height: 60vh">
  <div class="row">
    <div class="col-md-12">
      <div class="row">
        <div class="col-md-7">
          <br>
          <h2>Pólizas Accidentes Personales</h2>
        </div>
        <div class="col-md-5">
          <div class="input-group-append">
            <button style="font-size: 30px; margin-top: 20px;" class="btn btn-info" (click)='go_to_policies_generate()'>Nueva Pòliza AP</button>
          </div>
        </div>

      </div>

      <div class="row">
        <div class="col-md-12" align="right">
          <span class="bold-opensans">Total: {{total_policies}}  pólizas</span>
        </div>
        <div class="col-md-12">
          <div class="col-md-2">
            <input
              type="text"
              style=""
              placeholder="Filtro Poliza"
              (keyup)="updateFilter($event)"
            />
          </div>
        </div>
        <div class="col-md-12">
          <ngx-datatable class="bootstrap fullscreen"
            [headerHeight]="40"
            [summaryRow]="true"
            [summaryPosition]="'bottom'"
            [footerHeight]="30"
            [limit]="20"
            [rowHeight]="'auto'"
            [reorderable]="true"
            [sortType]="'single'"
            [columnMode]="'force'"
            [rows]="rows" >

            <ngx-datatable-column name="Poliza" [sortable]="true">
              <ng-template let-column="column" ngx-datatable-header-template> {{ column.name }} </ng-template>
              <ng-template let-value="value" ngx-datatable-cell-template>
                <strong>{{ value }}</strong>
              </ng-template>
            </ngx-datatable-column>

            <ngx-datatable-column name="Asegurado" [sortable]="true">
              <ng-template let-column="column" ngx-datatable-header-template> {{ column.name }} </ng-template>
              <ng-template let-value="value" ngx-datatable-cell-template>
                <p><strong>{{ value }}</strong></p>
              </ng-template>
            </ngx-datatable-column>

            <ngx-datatable-column name="Correo" [sortable]="true">
              <ng-template let-column="column" ngx-datatable-header-template> {{ column.name }} </ng-template>
              <ng-template let-value="value" ngx-datatable-cell-template>
                <strong>{{ value }}</strong>
              </ng-template>
            </ngx-datatable-column>

            <ngx-datatable-column name="Estatus" [sortable]="true">
              <ng-template let-column="column" ngx-datatable-header-template>{{ column.name }} </ng-template>
              <ng-template let-value="value" ngx-datatable-cell-template>
                <strong>{{ value == 'quote' ? 'Cotización' : value == 'policy_active' ? 'Póliza activa' : value }}</strong>
              </ng-template>
            </ngx-datatable-column>

            <ngx-datatable-column name="Tipo"  [sortable]="true" >
              <ng-template let-column="column" ngx-datatable-header-template> {{ column.name }} </ng-template>
              <ng-template let-value="value" ngx-datatable-cell-template>
                <strong>{{ value }}</strong>
              </ng-template>
            </ngx-datatable-column>


           <ngx-datatable-column name="Vigencia">
             <ng-template let-column="column" ngx-datatable-header-template> {{ column.name }} </ng-template>
             <ng-template let-value="value" ngx-datatable-cell-template>
                <strong>{{ value | date: 'dd/MM/yyyy' }}</strong>
             </ng-template>
           </ngx-datatable-column>


          <ngx-datatable-column name="Acciones">
            <ng-template let-column="column" ngx-datatable-header-template>  {{ column.name }} </ng-template>
            <ng-template let-value="value" ngx-datatable-cell-template>
              <button *ngIf="value['status_policy']=='quote'" style="margin-bottom:5px" class="btn transparent_button" type="button" name="button" (click)='go_to_policies_generate_already_quote(value.id)'><i class="far fa-credit-card"></i> Pagar cotizacion</button>
              <button *ngIf="value['status_policy'] !='quote'" style="margin-bottom:5px" class="btn transparent_button" type="button" name="button"><i class="far fa-credit-card"></i> Pagar mensualidad</button>
               <br>
              <button style="margin-bottom:5px" class="btn transparent_button" type="button" name="button" (click)="show_modal(value)"><i class="fas fa-file-invoice-dollar"></i> Ver detalles</button>
            </ng-template>
          </ngx-datatable-column>
         </ngx-datatable>

        </div>

      </div>

    </div>
  </div>
</section>

<div *ngIf="current_policy_details != false" id="modalDetails" class="modal fade bd-example-modal-xl" tabindex="-1" role="dialog" aria-labelledby="myExtraLargeModalLabel" aria-hidden="true">
  <div class="modal-dialog  modal-lg">
    <div class="modal-content container">
      <div class="row">
        <div class="col-md-12">
          <h2>Detalles de la Póliza</h2>
        </div>
        <div class="col-md-12">
          <div class="row">
            <div class="col-md-12">
              <hr>
              <p style="text-align:center"> <b>{{current_policy_details.policy_type.name}} </b></p>
              <hr>
            </div>
            <div class="col-md-6">
              <p>Id de poliza: <b>{{current_policy_details.carrier_policy_id}}</b></p>
              <hr>
              <p>Asegurado Principal: <b> {{current_policy_details.insured_person.name + ' ' + current_policy_details.insured_person.first_name + ' ' + current_policy_details.insured_person.last_name}} </b></p>
              <hr>
              <p>Inicio de Vigencia: <b>{{current_policy_details.begin_at | date: 'dd/MM/yyyy'}}</b> </p>
              <hr>
              <p>Email: <b> {{current_policy_details.insured_person.email}} </b></p>
              <hr>
            </div>
            <div class="col-md-6">
              <p>Calle: <b>{{current_policy_details.insured_person.address + " " + current_policy_details.insured_person.ext_number + ", Int: " + current_policy_details.insured_person.int_number }}</b></p>
              <hr>
              <p>Colonia: <b>{{current_policy_details.insured_person.address_2 }}</b></p>
              <hr>
              <p>Estado: <b> {{current_policy_details.insured_person.state.label}} </b> </p>
              <hr>
              <p>Ciudad/delegacion: <b> {{current_policy_details.insured_person.city.label}} </b></p>
              <hr>
            </div>
            <div class="col-md-12">
              <hr>
                <p style="text-align:center"><b>Beneficiarios</b></p>
              <hr>
            </div>
            <div *ngFor="let benefit of current_policy_details.beneficiary" class="col-md-12">
              <div class="row" *ngIf="benefit.name!=''">
                <div class="col-md-4">
                  <p>Nombre: <b>{{benefit.name}} {{benefit.first_name}} {{benefit.last_name}} </b></p>
                </div>
                <div class="col-md-4">
                  <p>Porcentaje: <b>{{benefit.percentage}}% </b></p>
                </div>
                <div class="col-md-4">
                  <p>Relaciòn: <b>{{benefit.relationship == 'D' ? 'Hijos' : benefit.relationship == 'H' ? 'Hermanos' : benefit.relationship == 'F' ? 'Padres' : benefit.relationship == 'S' ? 'Conyuge' : 'Otros'  }}% </b></p>
                </div>
              </div>
            </div>

            <div class="col-md-12">
              <hr>
                <p style="text-align:center"><b>Asegurados</b></p>
              <hr>
            </div>
            <div *ngFor="let benefit of current_policy_details.insurance_objects" class="col-md-12">
              <div class="row" *ngIf="benefit.name!=''">
                <div class="col-md-4">
                  <p>Nombre: <b>{{benefit.insurance_object_data.name}} {{benefit.insurance_object_data.first_name}} {{benefit.insurance_object_data.last_name}} </b></p>
                </div>
                <div class="col-md-4">
                  <p>Fecha nacimiento: <b>{{benefit.insurance_object_data.birth_date | date: 'dd/MM/yyyy'}} </b></p>
                </div>
                <div class="col-md-4">
                  <p>Relaciòn: <b>{{benefit.insurance_object_data.relationship == 'D' ? 'Hijos' : benefit.insurance_object_data.relationship == 'H' ? 'Hermanos' : benefit.insurance_object_data.relationship == 'F' ? 'Padres' : benefit.insurance_object_data.relationship == 'S' ? 'Conyuge' : 'Otros'  }} </b></p>
                </div>
              </div>
            </div>


          </div>

        </div>

        <div class="offset-md-4 col-md-4">
          <button data-dismiss="modal" aria-label="Close" type="button" class="btn btn-sxkm-dark-green btn-lg btn-block">
            Cerrar
          </button>
          <br><br>
        </div>
      </div>
    </div>
  </div>
</div>
