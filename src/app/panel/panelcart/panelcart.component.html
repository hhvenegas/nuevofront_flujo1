<ngx-spinner
bdColor = "rgba(51, 51, 51, 0.8)"
size = "large"
color = "#fff"
type = "ball-8bits"
></ngx-spinner>
<section>
    <div class="container-fluid">
        <form #f="ngForm" (ngSubmit)="onSubmit()" ngNativeValidate>
            <div class="row">
                <div class="offset-1 col-12 col-md-7" align="justify">
                   <div class="row">
                       <div class="col-md-12">
                           <br><br>
                           <h2 *ngIf="isCompra">Primera compra de paquete de kilómetros</h2>
                           <h2 *ngIf="isRecarga">Recarga de kilómetros</h2>
                           <h2 *ngIf="isSubscription">Pago de mensualidad</h2>
                       </div>
                    </div>
                    <div class="row" *ngIf="!isSubscription">
                        <div class="col-md-12">
                            <div class="card">
                                <div class="card-header">
                                    <span class="bold-opensans" for="">Paquete de kilómetros</span>
                                </div>
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-md-12">
                                            <span class="bold-opensans" for="">Paquete de kilómetros:</span>
                                            <select class="form-control" name="package" [(ngModel)]="kilometer_purchase.kilometers" required (change)="changePackage()">
                                                <option value="" disabled>Seleccionar paquete</option>
                                                <option *ngFor="let package of package_costs" value="{{package.package}}">Paquete de {{package.package | number}} km</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <br>
                        </div>
                    </div>
                    <div class="row" *ngIf="isCompra">
                        <div class="col-md-12">
                            <div class="card">
                                <div class="card-header">
                                    <span class="bold-opensans">Datos personales</span>
                                </div>
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-md-4">
                                            <span class="bold-opensans">Nombre:</span>
                                            <input [(ngModel)]="policy.first_name" class="form-control" type="text" name="nombre" required>
                                        </div>
                                        <div class="col-md-4">
                                            <span class="bold-opensans">Apellido Paterno:</span>
                                            <input class="form-control" type="text" name="paterno" [(ngModel)]="policy.last_name" value="" placeholder="" required>
                                        </div>
                                        <div class="col-md-4">
                                            <span class="bold-opensans">Apellido Materno:</span>
                                            <input class="form-control" type="text" name="materno" value="" placeholder="" [(ngModel)]="policy.second_last_name" required>
                                        </div>
                                        <div class="col-md-4">
                                            <span class="bold-opensans">Teléfono:</span>
                                            <input class="form-control" type="text" name="phone" value="" placeholder="" [(ngModel)]="policy.phone" required>
                                        </div>
                                        <div class="col-md-8">
                                            <span class="bold-opensans">Correo:</span>
                                            <input class="form-control" type="email" name="email" value="" placeholder="" [(ngModel)]="user.email" disabled>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <br>
                        </div>
                    </div>
                    <div class="row" *ngIf="isCompra">
                        <div class="col-md-12">
                            <div class="card">
                                <div class="card-header">
                                    <span class="bold-opensans">Datos del auto</span>
                                </div>
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-md-4">
                                            <span class="bold-opensans">Placas:</span>
                                            <input class="form-control" type="text" name="plates" value="" placeholder="" [(ngModel)]="car.plates">
                                        </div>
                                        <div class="col-md-4">
                                            <span class="bold-opensans">VIN:</span>
                                            <input class="form-control" type="text" name="vin" value="" placeholder="" [(ngModel)]="car.vin">
                                        </div>
                                        <div class="col-md-4">
                                            <span class="bold-opensans">Número de motor:</span>
                                            <input class="form-control" type="text" name="motor_number" value="" placeholder="" [(ngModel)]="car.motor_number">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <br>
                        </div>
                    </div>
                    <div class="row" *ngIf="isCompra">
                        <div class="col-md-12">
                            <div class="card">
                                <div class="card-header">
                                    <span class="bold-opensans">Dirección de póliza</span>
                                </div>
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <span class="bold-opensans">Calle:</span>
                                            <input class="form-control" type="text" name="policy.street" [(ngModel)]="policy.street" value="" placeholder="" required>
                                        </div>
                                        <div class="col-md-3">
                                            <span class="bold-opensans">No. Exterior:</span>
                                            <input class="form-control" type="text" name="policy.ext_number" [(ngModel)]="policy.ext_number" value="" placeholder="" required>
                                        </div>
                                        <div class="col-md-3">
                                            <span class="bold-opensans">No. Interior:</span>
                                            <input class="form-control" type="text" name="policy.int_number" [(ngModel)]="policy.int_number" value="" placeholder="">
                                        </div>
                                        <div class="col-md-6">
                                            <span class="bold-opensans">Colonia:</span>
                                            <select class="form-control" name="suburbs.policy" [(ngModel)]="policy.suburb" (change)="setDireccion('policy')" required>
                                                <option value="">Seleccionar</option>
                                                <option *ngFor="let suburb of suburbs.policy" value="{{suburb.suburb}}">{{suburb.suburb}}</option>
                                            </select>
                                        </div>
                                        <div class="col-md-6">
                                            <span class="bold-opensans">Código postal:</span>
                                            <input class="form-control" type="text" name="policy.zip_code" [(ngModel)]="policy.zip_code" value="" placeholder="" readonly>
                                        </div>    
                                        <div class="col-md-6">
                                            <span class="bold-opensans">Ciudad:</span>
                                            <input class="form-control" type="text" name="policy.municipality" value="" placeholder="" [(ngModel)]="policy.municipality" readonly>
                                        </div>
                                        <div class="col-md-6">
                                            <span class="bold-opensans">Estado:</span>
                                            <input class="form-control" type="text" name="policy.federal_entity" [(ngModel)]="policy.federal_entity" value="" placeholder="" readonly>
                                        </div>
                                        <div class="col-md-12">
                                            <br>
                                            <div *ngIf="!boolean_shipping" class="custom-control custom-checkbox" (click)="changeShipping()">
                                                <input type="checkbox" class="custom-control-input" id="customCheck1"  >
                                                <label class="custom-control-label" for="customCheck1">&nbsp;&nbsp; Enviar dispositivo a otra dirección.</label>
                                            </div>
                                            <div *ngIf="boolean_shipping" class="custom-control custom-checkbox" (click)="changeShipping()">
                                                <input type="checkbox" class="custom-control-input" id="customCheck1"  checked>
                                                <label class="custom-control-label" for="customCheck1">&nbsp;&nbsp; Enviar dispositivo a otra dirección.</label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <br>
                        </div>
                    </div>
                    <div *ngIf="boolean_shipping && isCompra" class="row">
                        <div class="col-md-12">
                            <div class="card">
                                <div class="card-header">
                                    <span class="bold-opensans">Dirección de envío</span>
                                </div>
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <span class="bold-opensans">Calle:</span>
                                            <input class="form-control" type="text" name="shipping.street" [(ngModel)]="shipping.street" value="" placeholder="" required>
                                        </div>
                                        <div class="col-md-3">
                                            <span class="bold-opensans">No. Exterior:</span>
                                            <input class="form-control" type="text" name="shipping.ext_number" [(ngModel)]="shipping.ext_number" value="" placeholder="" required>
                                        </div>
                                        <div class="col-md-3">
                                            <span class="bold-opensans">No. Interior:</span>
                                            <input class="form-control" type="text" name="shipping.int_number" [(ngModel)]="shipping.int_number" value="" placeholder="">
                                        </div>
                                        <div class="col-md-6">
                                            <span class="bold-opensans">Código postal:</span>
                                            <input class="form-control" type="text" name="shipping.zip_code" [(ngModel)]="shipping.zip_code" value="" placeholder="" (change)="getZipcode('shipping',shipping.zip_code)" required>
                                        </div>
                                        <div class="col-md-6">
                                            <span class="bold-opensans">Colonia:</span>
                                            <select class="form-control" name="suburbs.shipping" [(ngModel)]="shipping.suburb" (change)="setDireccion('shipping')" required>
                                                <option value="">Seleccionar</option>
                                                <option *ngFor="let suburb of suburbs.shipping" value="{{suburb.suburb}}">{{suburb.suburb}}</option>
                                            </select>    
                                        </div>
                                        <div class="col-md-6">
                                            <span class="bold-opensans">Ciudad:</span>
                                            <input class="form-control" type="text" name="shipping.municipality" [(ngModel)]="shipping.municipality" value="" placeholder="" readonly>
                                        </div>
                                        <div class="col-md-6">
                                            <span class="bold-opensans">Estado:</span>
                                            <input class="form-control" type="text" name="shipping.federal_entity" [(ngModel)]="shipping.federal_entity" value="" placeholder="" readonly>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <br>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12">
                            <div class="card">
                                <div class="card-header">
                                    <span class="bold-opensans">Pago</span>
                                </div>
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-md-12">
                                            <span class="bold-opensans" >Método de pago:</span>
                                            <select class="form-control" name="paymethod" [(ngModel)]="paymethod" required  (change)="changePaymethod()">
                                                <option value="credit_card">Tarjeta de débito / crédito</option>
                                                <option value="oxxo">Oxxo</option>
                                                <option value="open_pay">Tiendas convencionales openpay</option>
                                                <option value="spei">Spei</option>
                                            </select>
                                            <br>
                                        </div>
                                        <div *ngIf="boolean_isCard && cards.length>0" class="col-md-6">
                                            <span class="bold-opensans" >Tarjetas:</span>
                                            <select *ngIf="cards.length>0 && !boolean_new_card" class="form-control" name="card_id" [(ngModel)]="card_id" required (change)="newCard(false)" >
                                                <option value="" disabled>Selecciona tarjeta</option>
                                                <option value="{{card.id}}" *ngFor="let card of cards">{{card.bank}} - {{card.brand.toUpperCase()}} - {{card.card_number}}</option>
                                            </select>
                                            <select *ngIf="cards.length>0 && boolean_new_card" class="form-control" name="card_id" [(ngModel)]="card_id"  (change)="newCard(false)" >
                                                <option value="" disabled>Selecciona tarjeta</option>
                                                <option value="{{card.id}}" *ngFor="let card of cards">{{card.bank}} - {{card.brand.toUpperCase()}} - {{card.card_number}}</option>
                                            </select>
                                            <br>
                                        </div>
                                        <div *ngIf="boolean_isCard && cards.length>0" class="col-md-6">
                                            <br>
                                            <button type="button" class="btn btn-info btn-lg" (click)="newCard(true)">Nueva Tarjeta</button>
                                            <br>
                                        </div>
                                        <div class="col-md-12" *ngIf="boolean_isCard">
                                            <div *ngIf="!boolean_subscription" class="custom-control custom-checkbox" (click)="changeSubscription()">
                                                <input type="checkbox" class="custom-control-input" id="customCheck2"  >
                                                <label class="custom-control-label" for="customCheck2">&nbsp;&nbsp; Pago recurrente.</label>
                                            </div>
                                            <div *ngIf="boolean_subscription" class="custom-control custom-checkbox" (click)="changeSubscription()">
                                                <input type="checkbox" class="custom-control-input" id="customCheck2"  checked>
                                                <label class="custom-control-label" for="customCheck2">&nbsp;&nbsp; Pago recurrente.</label>
                                            </div>
                                            <br>
                                        </div>
                                    </div>
                                    <div class="row" *ngIf=" boolean_isCard && boolean_new_card">
                                        <div class="col-md-12">
                                            <span class="bold-opensans">Número de tarjeta</span>
                                            <input class="form-control" type="text" name="card_number" [(ngModel)]="card.card_number" value="" placeholder="" required>
                                        </div>
                                        <div class="col-md-12">
                                            <span class="bold-opensans">Nombre del titular</span>
                                            <input class="form-control" type="text" name="holder_name" [(ngModel)]="card.holder_name" value="" placeholder="" required>
                                        </div>
                                        <div class="col-md-12">
                                            <div class="row">
                                                <div class="col-md-6">
                                                    <div class="row">
                                                        <div class="col-md-12">
                                                            <span class="bold-opensans">Fecha de vigencia</span>
                                                        </div>
                                                        <div class="col-md-6">
                                                            <select class="form-control" name="expiration_month" [(ngModel)]="card.expiration_month"  required >
                                                                <option value="">Mes</option>
                                                                <option value="01">01</option>
                                                                <option value="02">02</option>
                                                                <option value="03">03</option>
                                                                <option value="04">04</option>
                                                                <option value="05">05</option>
                                                                <option value="06">06</option>
                                                                <option value="07">07</option>
                                                                <option value="08">08</option>
                                                                <option value="09">09</option>
                                                                <option value="10">10</option>
                                                                <option value="11">11</option>
                                                                <option value="12">12</option>
                                                            </select>
                                                        </div>
                                                        <div class="col-md-6">
                                                            <select class="form-control" name="card.expiration_year" [(ngModel)]="card.expiration_year" required >
                                                                <option value="">Año</option>
                                                                <option value="18">2018</option>
                                                                <option value="19">2019</option>
                                                                <option value="20">2020</option>
                                                                <option value="21">2021</option>
                                                                <option value="21">2022</option>
                                                                <option value="23">2023</option>
                                                                <option value="24">2024</option>
                                                                <option value="25">2025</option>
                                                                <option value="26">2026</option>
                                                                <option value="27">2027</option>
                                                                <option value="28">2028</option>
                                                                <option value="29">2029</option>
                                                                <option value="30">2030</option>
                                                            </select>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <span class="bold-opensans">CVV:</span>
                                                    <input class="form-control" type="text" name="cvv2" [(ngModel)]="card.cvv2" value="" placeholder="" required>
                                                </div>
                                                <div class="col-md-12">
                                                    <br>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-12">
                                            <div *ngIf="!boolean_invoicing" class="custom-control custom-checkbox" (click)="changeInvoincing()">
                                                <input type="checkbox" class="custom-control-input" id="customCheck3"  >
                                                <label class="custom-control-label" for="customCheck3">&nbsp;&nbsp; Requiere factura.</label>
                                            </div>
                                            <div *ngIf="boolean_invoicing" class="custom-control custom-checkbox" (click)="changeInvoincing()">
                                                <input type="checkbox" class="custom-control-input" id="customCheck3"  checked>
                                                <label class="custom-control-label" for="customCheck3">&nbsp;&nbsp; Requiere factura.</label>
                                            </div>
                                            <br>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <br>
                        </div>  
                    </div>
                    <div *ngIf="boolean_invoicing" class="row">
                        <div class="col-md-12">
                            <div class="card">
                                <div class="card-header">
                                    <span class="bold-opensans">Datos de Facturación</span>
                                </div>
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-md-5">
                                            <span class="bold-opensans">Razón social</span>
                                            <input class="form-control" type="text" name="billing.legal_name" [(ngModel)]="billing.legal_name" value="" placeholder="" required>
                                        </div>
                                        <div class="col-md-5">
                                            <span class="bold-opensans">RFC</span>
                                            <input class="form-control" type="text" name="billing.rfc" value="" placeholder="" required [(ngModel)]="billing.rfc">
                                        </div>
                                        <div class="col-md-2">
                                            <span class="bold-opensans">Código postal</span>
                                            <input class="form-control" type="text" name="billing.zip_code" [(ngModel)]="billing.zip_code" value="" placeholder="" required>
                                        </div>
                                    </div>  
                                </div>
                            </div>
                        </div>  
                        <div class="col-md-12">
                            <br><br><br>
                        </div>
                    </div>
                </div>
                <div class="col-md-4 border-left" style="">
                    <br><br>
                    <div class="sticky-top" style="top:100px">
                        <div *ngIf="car_object.maker!=''"  class="row">
                            <div class="col-md-3">
                                <img *ngIf="car_object.maker!=''" src="/assets/img/makers/{{car_object.maker}}.png" alt="..." class="rounded shadow border" style="width: 70px;height: 70px">
                            </div>
                            <div class="col-md-9">
                                <span style="font-size: 20px" class="bold-opensans">
                                    {{car_object.version}} {{car_object.year}}
                                </span>
                            </div>
                            <div class="col-md-12">
                                <br>
                            </div>
                        </div>
                        <div *ngIf="!isSubscription" class="row">
                            <div class="col-md-12">
                                <div class="card">
                                    <div class="card-body">
                                        <div class="row">
                                            <div class="col-md-6">
                                                <span class="bold-opensans align-middle">
                                                    Paquete de {{kilometer_purchase.kilometers | number}} km
                                                </span>
                                            </div>
                                            <div class="col-md-6" align="right">
                                                <span style="font-size: 20px" class="bold-opensans">
                                                    {{kilometer_purchase.cost | currency}}
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <br>
                            </div>
                        </div>
                        <div *ngIf="!isRecarga" class="row">
                            <div class="col-md-12">
                                <div class="card">
                                    <div class="card-body">
                                        <div class="row">
                                            <div class="col-md-6">
                                                <span class="bold-opensans align-middle">
                                                    Suscripción mensual
                                                </span>
                                            </div>
                                            <div class="col-md-6" align="right">
                                                <span style="font-size: 20px" class="bold-opensans">
                                                    {{kilometer_purchase.initial_payment | currency}}
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <br>
                            </div>  
                        </div>
                        <div class="row">
                            <div class="col-md-12" align="right">
                                <span class="bold-opensans">Subtotal: {{subtotal | currency}}</span> <br>
                                <span class="bold-opensans">Descuento: {{discount | currency}}</span> <br>
                                <span style="font-size: 25px" class="bold-opensans">Total: {{total | currency}}</span>
                                <br><br>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12">
                                <div class="input-group mb-3">
                                    <input [(ngModel)]="cupon" type="text" name="cupon" class="form-control" placeholder="Cupón" >
                                    <div class="input-group-append">
                                        <span class="input-group-text" id="basic-addon2" (click)="setCupon()">
                                            Aplicar
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12">
                                <div class="custom-control custom-checkbox" >
                                    <input type="checkbox" class="custom-control-input" id="customCheck4"  required>
                                    <label class="custom-control-label" for="customCheck4">&nbsp;&nbsp; Acepto términos y condiciones.</label>
                                </div>
                                <br>
                                <button type="submit" class="btn btn-sxkm-green btn-lg btn-block">
                                    Pagar
                                </button>
                                <br><br>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </form>
    </div>  
</section>